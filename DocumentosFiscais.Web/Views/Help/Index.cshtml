@{
    ViewData["Title"] = "Central de Ajuda";
}

<div class="container-fluid p-0">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
            <h1 class="h3 mb-2 text-gray-800 fw-bold">Central de Ajuda</h1>
            <p class="text-muted mb-0">Encontre respostas e obtenha suporte para o sistema</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn-modern btn-primary-modern" onclick="openFeedbackModal()">
                <i class="bi bi-chat-dots"></i>
                Enviar Feedback
            </button>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="modern-card mb-4">
        <div class="card-body p-4">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="search-container">
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0">
                                <i class="bi bi-search text-muted"></i>
                            </span>
                            <input type="text" class="form-control border-start-0" 
                                   placeholder="Pesquisar na documentação..." 
                                   id="helpSearch"
                                   onkeyup="searchHelp(this.value)">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Help Cards -->
    <div class="row g-4 mb-4">
        <div class="col-lg-3 col-md-6">
            <div class="help-card modern-card h-100" onclick="location.href='/Help/FAQ'">
                <div class="card-body p-4 text-center">
                    <div class="help-icon mb-3">
                        <i class="bi bi-question-circle text-primary"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Perguntas Frequentes</h5>
                    <p class="text-muted mb-3">Respostas para as dúvidas mais comuns</p>
                    <span class="btn-modern btn-secondary-modern btn-sm">
                        Ver FAQ <i class="bi bi-arrow-right"></i>
                    </span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="help-card modern-card h-100" onclick="location.href='/Help/Documentation'">
                <div class="card-body p-4 text-center">
                    <div class="help-icon mb-3">
                        <i class="bi bi-book text-info"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Documentação</h5>
                    <p class="text-muted mb-3">Guias completos de uso do sistema</p>
                    <span class="btn-modern btn-secondary-modern btn-sm">
                        Ver Docs <i class="bi bi-arrow-right"></i>
                    </span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="help-card modern-card h-100" onclick="location.href='/Help/Contact'">
                <div class="card-body p-4 text-center">
                    <div class="help-icon mb-3">
                        <i class="bi bi-headset text-success"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Suporte</h5>
                    <p class="text-muted mb-3">Entre em contato com nossa equipe</p>
                    <span class="btn-modern btn-secondary-modern btn-sm">
                        Contatar <i class="bi bi-arrow-right"></i>
                    </span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="help-card modern-card h-100" onclick="location.href='/Help/SystemInfo'">
                <div class="card-body p-4 text-center">
                    <div class="help-icon mb-3">
                        <i class="bi bi-info-circle text-warning"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Sistema</h5>
                    <p class="text-muted mb-3">Informações técnicas e versão</p>
                    <span class="btn-modern btn-secondary-modern btn-sm">
                        Ver Info <i class="bi bi-arrow-right"></i>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Popular Topics -->
    <div class="row g-4">
        <div class="col-lg-8">
            <div class="modern-card">
                <div class="card-header-modern">
                    <h6 class="card-title-modern">
                        <i class="bi bi-fire text-danger"></i>
                        Tópicos Populares
                    </h6>
                </div>
                <div class="card-body p-0">
                    <div class="help-topics">
                        <div class="topic-item" onclick="expandTopic(this)">
                            <div class="topic-header">
                                <div class="d-flex align-items-center gap-3">
                                    <i class="bi bi-upload text-primary"></i>
                                    <div>
                                        <div class="topic-title">Como fazer upload de documentos XML?</div>
                                        <div class="topic-desc">Guia passo a passo para envio de arquivos</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-down topic-arrow"></i>
                            </div>
                            <div class="topic-content">
                                <ol class="ps-3">
                                    <li>Acesse a página de <strong>Upload</strong> no menu lateral</li>
                                    <li>Arraste e solte seus arquivos XML ou clique para selecionar</li>
                                    <li>Aguarde o processamento automático</li>
                                    <li>Verifique os resultados na lista de documentos</li>
                                </ol>
                                <div class="alert alert-info mt-3">
                                    <i class="bi bi-info-circle"></i>
                                    <strong>Dica:</strong> Arquivos de até 10MB são suportados. Formatos aceitos: CT-e, NF-e, MDF-e, NFC-e.
                                </div>
                            </div>
                        </div>

                        <div class="topic-item" onclick="expandTopic(this)">
                            <div class="topic-header">
                                <div class="d-flex align-items-center gap-3">
                                    <i class="bi bi-search text-success"></i>
                                    <div>
                                        <div class="topic-title">Como filtrar e buscar documentos?</div>
                                        <div class="topic-desc">Encontre rapidamente o que procura</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-down topic-arrow"></i>
                            </div>
                            <div class="topic-content">
                                <ul class="ps-3">
                                    <li><strong>Busca por nome:</strong> Digite no campo de pesquisa</li>
                                    <li><strong>Filtro por tipo:</strong> Use o dropdown "Tipo de Documento"</li>
                                    <li><strong>Filtro por status:</strong> Selecione o status desejado</li>
                                    <li><strong>Limpeza:</strong> Use o botão "Limpar Filtros"</li>
                                </ul>
                            </div>
                        </div>

                        <div class="topic-item" onclick="expandTopic(this)">
                            <div class="topic-header">
                                <div class="d-flex align-items-center gap-3">
                                    <i class="bi bi-shield-check text-warning"></i>
                                    <div>
                                        <div class="topic-title">Como validar documentos XML?</div>
                                        <div class="topic-desc">Verificação automática de estrutura e dados</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-down topic-arrow"></i>
                            </div>
                            <div class="topic-content">
                                <p>A validação é automática durante o upload, verificando:</p>
                                <ul class="ps-3">
                                    <li>Estrutura XML válida</li>
                                    <li>Schema do documento fiscal</li>
                                    <li>Integridade dos dados</li>
                                    <li>Assinatura digital (quando presente)</li>
                                </ul>
                                <p>Documentos com erro aparecem com status "Erro" na listagem.</p>
                            </div>
                        </div>

                        <div class="topic-item" onclick="expandTopic(this)">
                            <div class="topic-header">
                                <div class="d-flex align-items-center gap-3">
                                    <i class="bi bi-download text-info"></i>
                                    <div>
                                        <div class="topic-title">Como fazer download de documentos?</div>
                                        <div class="topic-desc">Exportar arquivos individuais ou em lote</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-down topic-arrow"></i>
                            </div>
                            <div class="topic-content">
                                <p><strong>Download individual:</strong></p>
                                <ul class="ps-3">
                                    <li>Clique no ícone de download na lista</li>
                                    <li>Ou acesse os detalhes e use "Download XML"</li>
                                </ul>
                                <p><strong>Download em lote:</strong></p>
                                <ul class="ps-3">
                                    <li>Selecione múltiplos documentos</li>
                                    <li>Use o botão "Exportar Selecionados"</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Quick Stats -->
            <div class="modern-card mb-4">
                <div class="card-header-modern">
                    <h6 class="card-title-modern">
                        <i class="bi bi-graph-up text-success"></i>
                        Estatísticas de Uso
                    </h6>
                </div>
                <div class="card-body p-4">
                    <div class="stats-help">
                        <div class="stat-help-item">
                            <div class="stat-help-icon">
                                <i class="bi bi-file-earmark-text"></i>
                            </div>
                            <div class="stat-help-info">
                                <div class="stat-help-number" id="totalDocs">-</div>
                                <div class="stat-help-label">Documentos Processados</div>
                            </div>
                        </div>
                        
                        <div class="stat-help-item">
                            <div class="stat-help-icon">
                                <i class="bi bi-clock-history"></i>
                            </div>
                            <div class="stat-help-info">
                                <div class="stat-help-number">99.9%</div>
                                <div class="stat-help-label">Uptime do Sistema</div>
                            </div>
                        </div>
                        
                        <div class="stat-help-item">
                            <div class="stat-help-icon">
                                <i class="bi bi-lightning"></i>
                            </div>
                            <div class="stat-help-info">
                                <div class="stat-help-number">&lt; 2s</div>
                                <div class="stat-help-label">Tempo de Processamento</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Updates -->
            <div class="modern-card">
                <div class="card-header-modern">
                    <h6 class="card-title-modern">
                        <i class="bi bi-megaphone text-primary"></i>
                        Atualizações Recentes
                    </h6>
                </div>
                <div class="card-body p-4">
                    <div class="updates-list">
                        <div class="update-item">
                            <div class="update-date">15 Ago 2025</div>
                            <div class="update-title">v1.0.0 - Lançamento</div>
                            <div class="update-desc">Sistema de gestão de documentos fiscais</div>
                        </div>
                        
                        <div class="update-item">
                            <div class="update-date">14 Ago 2025</div>
                            <div class="update-title">Interface Modernizada</div>
                            <div class="update-desc">Nova interface com tema escuro</div>
                        </div>
                        
                        <div class="update-item">
                            <div class="update-date">13 Ago 2025</div>
                            <div class="update-title">Melhorias Mobile</div>
                            <div class="update-desc">Otimizações para dispositivos móveis</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content" style="border-radius: var(--radius-lg); border: none; box-shadow: var(--shadow-xl);">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title fw-bold">
                    <i class="bi bi-chat-dots text-primary me-2"></i>
                    Enviar Feedback
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <form id="feedbackForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-medium">Nome</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-medium">Email</label>
                            <input type="email" class="form-control" name="email" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-medium">Tipo de Feedback</label>
                            <select class="form-select" name="type" required>
                                <option value="suggestion">Sugestão</option>
                                <option value="bug">Relatar Bug</option>
                                <option value="question">Pergunta</option>
                                <option value="compliment">Elogio</option>
                                <option value="complaint">Reclamação</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-medium">Assunto</label>
                            <input type="text" class="form-control" name="subject" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-medium">Mensagem</label>
                            <textarea class="form-control" name="message" rows="4" required></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-medium">Avaliação Geral</label>
                            <div class="rating-stars">
                                <i class="bi bi-star rating-star" data-rating="1"></i>
                                <i class="bi bi-star rating-star" data-rating="2"></i>
                                <i class="bi bi-star rating-star" data-rating="3"></i>
                                <i class="bi bi-star rating-star" data-rating="4"></i>
                                <i class="bi bi-star rating-star" data-rating="5"></i>
                            </div>
                            <input type="hidden" name="rating" value="5">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-top-0">
                <button type="button" class="btn-modern btn-secondary-modern" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn-modern btn-primary-modern" onclick="submitFeedback()">
                    <i class="bi bi-send"></i>
                    Enviar Feedback
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    .help-card {
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .help-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
    }

    .help-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(236, 72, 153, 0.1));
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
        border: 1px solid rgba(99, 102, 241, 0.2);
    }

    .help-icon i {
        font-size: 1.75rem;
    }

    .search-container .input-group-text {
        border-radius: var(--radius-md) 0 0 var(--radius-md);
    }

    .search-container .form-control {
        border-radius: 0 var(--radius-md) var(--radius-md) 0;
    }

    .help-topics {
        border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    }

    .topic-item {
        border-bottom: 1px solid var(--border-light);
        transition: all 0.2s ease;
    }

    .topic-item:last-child {
        border-bottom: none;
    }

    .topic-header {
        padding: 1.5rem;
        display: flex;
        align-items: center;
@{
    ViewData["Title"] = "Central de Ajuda";
}

<div class="container-fluid p-0">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
            <h1 class="h3 mb-2 text-gray-800 fw-bold">Central de Ajuda</h1>
            <p class="text-muted mb-0">Encontre respostas e obtenha suporte para o sistema</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn-modern btn-primary-modern" onclick="openFeedbackModal()">
                <i class="bi bi-chat-dots"></i>
                Enviar Feedback
            </button>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="modern-card mb-4">
        <div class="card-body p-4">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="search-container">
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0">
                                <i class="bi bi-search text-muted"></i>
                            </span>
                            <input type="text" class="form-control border-start-0" 
                                   placeholder="Pesquisar na documentação..." 
                                   id="helpSearch"
                                   onkeyup="searchHelp(this.value)">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Help Cards -->
    <div class="row g-4 mb-4">
        <div class="col-lg-3 col-md-6">
            <div class="help-card modern-card h-100" onclick="location.href='/Help/FAQ'">
                <div class="card-body p-4 text-center">
                    <div class="help-icon mb-3">
                        <i class="bi bi-question-circle text-primary"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Perguntas Frequentes</h5>
                    <p class="text-muted mb-3">Respostas para as dúvidas mais comuns</p>
                    <span class="btn-modern btn-secondary-modern btn-sm">
                        Ver FAQ <i class="bi bi-arrow-right"></i>
                    </span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="help-card modern-card h-100" onclick="location.href='/Help/Documentation'">
                <div class="card-body p-4 text-center">
                    <div class="help-icon mb-3">
                        <i class="bi bi-book text-info"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Documentação</h5>
                    <p class="text-muted mb-3">Guias completos de uso do sistema</p>
                    <span class="btn-modern btn-secondary-modern btn-sm">
                        Ver Docs <i class="bi bi-arrow-right"></i>
                    </span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="help-card modern-card h-100" onclick="location.href='/Help/Contact'">
                <div class="card-body p-4 text-center">
                    <div class="help-icon mb-3">
                        <i class="bi bi-headset text-success"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Suporte</h5>
                    <p class="text-muted mb-3">Entre em contato com nossa equipe</p>
                    <span class="btn-modern btn-secondary-modern btn-sm">
                        Contatar <i class="bi bi-arrow-right"></i>
                    </span>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="help-card modern-card h-100" onclick="location.href='/Help/SystemInfo'">
                <div class="card-body p-4 text-center">
                    <div class="help-icon mb-3">
                        <i class="bi bi-info-circle text-warning"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Sistema</h5>
                    <p class="text-muted mb-3">Informações técnicas e versão</p>
                    <span class="btn-modern btn-secondary-modern btn-sm">
                        Ver Info <i class="bi bi-arrow-right"></i>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Popular Topics -->
    <div class="row g-4">
        <div class="col-lg-8">
            <div class="modern-card">
                <div class="card-header-modern">
                    <h6 class="card-title-modern">
                        <i class="bi bi-fire text-danger"></i>
                        Tópicos Populares
                    </h6>
                </div>
                <div class="card-body p-0">
                    <div class="help-topics">
                        <div class="topic-item" onclick="expandTopic(this)">
                            <div class="topic-header">
                                <div class="d-flex align-items-center gap-3">
                                    <i class="bi bi-upload text-primary"></i>
                                    <div>
                                        <div class="topic-title">Como fazer upload de documentos XML?</div>
                                        <div class="topic-desc">Guia passo a passo para envio de arquivos</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-down topic-arrow"></i>
                            </div>
                            <div class="topic-content">
                                <ol class="ps-3">
                                    <li>Acesse a página de <strong>Upload</strong> no menu lateral</li>
                                    <li>Arraste e solte seus arquivos XML ou clique para selecionar</li>
                                    <li>Aguarde o processamento automático</li>
                                    <li>Verifique os resultados na lista de documentos</li>
                                </ol>
                                <div class="alert alert-info mt-3">
                                    <i class="bi bi-info-circle"></i>
                                    <strong>Dica:</strong> Arquivos de até 10MB são suportados. Formatos aceitos: CT-e, NF-e, MDF-e, NFC-e.
                                </div>
                            </div>
                        </div>

                        <div class="topic-item" onclick="expandTopic(this)">
                            <div class="topic-header">
                                <div class="d-flex align-items-center gap-3">
                                    <i class="bi bi-search text-success"></i>
                                    <div>
                                        <div class="topic-title">Como filtrar e buscar documentos?</div>
                                        <div class="topic-desc">Encontre rapidamente o que procura</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-down topic-arrow"></i>
                            </div>
                            <div class="topic-content">
                                <ul class="ps-3">
                                    <li><strong>Busca por nome:</strong> Digite no campo de pesquisa</li>
                                    <li><strong>Filtro por tipo:</strong> Use o dropdown "Tipo de Documento"</li>
                                    <li><strong>Filtro por status:</strong> Selecione o status desejado</li>
                                    <li><strong>Limpeza:</strong> Use o botão "Limpar Filtros"</li>
                                </ul>
                            </div>
                        </div>

                        <div class="topic-item" onclick="expandTopic(this)">
                            <div class="topic-header">
                                <div class="d-flex align-items-center gap-3">
                                    <i class="bi bi-shield-check text-warning"></i>
                                    <div>
                                        <div class="topic-title">Como validar documentos XML?</div>
                                        <div class="topic-desc">Verificação automática de estrutura e dados</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-down topic-arrow"></i>
                            </div>
                            <div class="topic-content">
                                <p>A validação é automática durante o upload, verificando:</p>
                                <ul class="ps-3">
                                    <li>Estrutura XML válida</li>
                                    <li>Schema do documento fiscal</li>
                                    <li>Integridade dos dados</li>
                                    <li>Assinatura digital (quando presente)</li>
                                </ul>
                                <p>Documentos com erro aparecem com status "Erro" na listagem.</p>
                            </div>
                        </div>

                        <div class="topic-item" onclick="expandTopic(this)">
                            <div class="topic-header">
                                <div class="d-flex align-items-center gap-3">
                                    <i class="bi bi-download text-info"></i>
                                    <div>
                                        <div class="topic-title">Como fazer download de documentos?</div>
                                        <div class="topic-desc">Exportar arquivos individuais ou em lote</div>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-down topic-arrow"></i>
                            </div>
                            <div class="topic-content">
                                <p><strong>Download individual:</strong></p>
                                <ul class="ps-3">
                                    <li>Clique no ícone de download na lista</li>
                                    <li>Ou acesse os detalhes e use "Download XML"</li>
                                </ul>
                                <p><strong>Download em lote:</strong></p>
                                <ul class="ps-3">
                                    <li>Selecione múltiplos documentos</li>
                                    <li>Use o botão "Exportar Selecionados"</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Quick Stats -->
            <div class="modern-card mb-4">
                <div class="card-header-modern">
                    <h6 class="card-title-modern">
                        <i class="bi bi-graph-up text-success"></i>
                        Estatísticas de Uso
                    </h6>
                </div>
                <div class="card-body p-4">
                    <div class="stats-help">
                        <div class="stat-help-item">
                            <div class="stat-help-icon">
                                <i class="bi bi-file-earmark-text"></i>
                            </div>
                            <div class="stat-help-info">
                                <div class="stat-help-number" id="totalDocs">-</div>
                                <div class="stat-help-label">Documentos Processados</div>
                            </div>
                        </div>
                        
                        <div class="stat-help-item">
                            <div class="stat-help-icon">
                                <i class="bi bi-clock-history"></i>
                            </div>
                            <div class="stat-help-info">
                                <div class="stat-help-number">99.9%</div>
                                <div class="stat-help-label">Uptime do Sistema</div>
                            </div>
                        </div>
                        
                        <div class="stat-help-item">
                            <div class="stat-help-icon">
                                <i class="bi bi-lightning"></i>
                            </div>
                            <div class="stat-help-info">
                                <div class="stat-help-number">&lt; 2s</div>
                                <div class="stat-help-label">Tempo de Processamento</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Updates -->
            <div class="modern-card">
                <div class="card-header-modern">
                    <h6 class="card-title-modern">
                        <i class="bi bi-megaphone text-primary"></i>
                        Atualizações Recentes
                    </h6>
                </div>
                <div class="card-body p-4">
                    <div class="updates-list">
                        <div class="update-item">
                            <div class="update-date">15 Ago 2025</div>
                            <div class="update-title">v1.0.0 - Lançamento</div>
                            <div class="update-desc">Sistema de gestão de documentos fiscais</div>
                        </div>
                        
                        <div class="update-item">
                            <div class="update-date">14 Ago 2025</div>
                            <div class="update-title">Interface Modernizada</div>
                            <div class="update-desc">Nova interface com tema escuro</div>
                        </div>
                        
                        <div class="update-item">
                            <div class="update-date">13 Ago 2025</div>
                            <div class="update-title">Melhorias Mobile</div>
                            <div class="update-desc">Otimizações para dispositivos móveis</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content" style="border-radius: var(--radius-lg); border: none; box-shadow: var(--shadow-xl);">
            <div class="modal-header border-bottom-0">
                <h5 class="modal-title fw-bold">
                    <i class="bi bi-chat-dots text-primary me-2"></i>
                    Enviar Feedback
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <form id="feedbackForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-medium">Nome</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-medium">Email</label>
                            <input type="email" class="form-control" name="email" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-medium">Tipo de Feedback</label>
                            <select class="form-select" name="type" required>
                                <option value="suggestion">Sugestão</option>
                                <option value="bug">Relatar Bug</option>
                                <option value="question">Pergunta</option>
                                <option value="compliment">Elogio</option>
                                <option value="complaint">Reclamação</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-medium">Assunto</label>
                            <input type="text" class="form-control" name="subject" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-medium">Mensagem</label>
                            <textarea class="form-control" name="message" rows="4" required></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label fw-medium">Avaliação Geral</label>
                            <div class="rating-stars">
                                <i class="bi bi-star rating-star" data-rating="1"></i>
                                <i class="bi bi-star rating-star" data-rating="2"></i>
                                <i class="bi bi-star rating-star" data-rating="3"></i>
                                <i class="bi bi-star rating-star" data-rating="4"></i>
                                <i class="bi bi-star rating-star" data-rating="5"></i>
                            </div>
                            <input type="hidden" name="rating" value="5">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-top-0">
                <button type="button" class="btn-modern btn-secondary-modern" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn-modern btn-primary-modern" onclick="submitFeedback()">
                    <i class="bi bi-send"></i>
                    Enviar Feedback
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    .help-card {
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .help-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
    }

    .help-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(236, 72, 153, 0.1));
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
        border: 1px solid rgba(99, 102, 241, 0.2);
    }

    .help-icon i {
        font-size: 1.75rem;
    }

    .search-container .input-group-text {
        border-radius: var(--radius-md) 0 0 var(--radius-md);
    }

    .search-container .form-control {
        border-radius: 0 var(--radius-md) var(--radius-md) 0;
    }

    .help-topics {
        border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    }

    .topic-item {
        border-bottom: 1px solid var(--border-light);
        transition: all 0.2s ease;
    }

    .topic-item:last-child {
        border-bottom: none;
    }

    .topic-header {
        padding: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .topic-header:hover {
        background: var(--gray-50);
    }

    .topic-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
    }

    .topic-desc {
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    .topic-arrow {
        font-size: 1rem;
        color: var(--text-secondary);
        transition: transform 0.3s ease;
    }

    .topic-item.expanded .topic-arrow {
        transform: rotate(180deg);
    }

    .topic-content {
        padding: 0 1.5rem 1.5rem;
        display: none;
        animation: fadeIn 0.3s ease;
    }

    .topic-item.expanded .topic-content {
        display: block;
    }

    .stats-help {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .stat-help-item {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .stat-help-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        flex-shrink: 0;
    }

    .stat-help-number {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-primary);
    }

    .stat-help-label {
        font-size: 0.8rem;
        color: var(--text-secondary);
    }

    .updates-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .update-item {
        padding: 1rem;
        background: var(--gray-50);
        border-radius: var(--radius-md);
        border-left: 3px solid var(--primary-color);
    }

    .update-date {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-bottom: 0.25rem;
    }

    .update-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
    }

    .update-desc {
        font-size: 0.875rem;
        color: var(--text-secondary);
    }

    .rating-stars {
        display: flex;
        gap: 0.25rem;
        margin-top: 0.5rem;
    }

    .rating-star {
        font-size: 1.5rem;
        color: var(--gray-300);
        cursor: pointer;
        transition: color 0.2s ease;
    }

    .rating-star:hover,
    .rating-star.active {
        color: #fbbf24;
    }

    @@media (max-width: 767px) {
        .help-topics .topic-header {
            padding: 1rem;
        }
        
        .help-topics .topic-content {
            padding: 0 1rem 1rem;
        }
        
        .stats-help {
            gap: 1rem;
        }
        
        .updates-list {
            gap: 0.75rem;
        }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadHelpStats();
    initRatingStars();
});

function expandTopic(element) {
    const isExpanded = element.classList.contains('expanded');
    
    // Fecha todos os outros tópicos
    document.querySelectorAll('.topic-item.expanded').forEach(item => {
        if (item !== element) {
            item.classList.remove('expanded');
        }
    });
    
    // Toggle no tópico clicado
    element.classList.toggle('expanded', !isExpanded);
}

function searchHelp(query) {
    const topics = document.querySelectorAll('.topic-item');
    const searchTerm = query.toLowerCase();
    
    topics.forEach(topic => {
        const title = topic.querySelector('.topic-title').textContent.toLowerCase();
        const desc = topic.querySelector('.topic-desc').textContent.toLowerCase();
        const content = topic.querySelector('.topic-content').textContent.toLowerCase();
        
        const matches = title.includes(searchTerm) || 
                       desc.includes(searchTerm) || 
                       content.includes(searchTerm);
        
        topic.style.display = matches || !query ? 'block' : 'none';
        
        if (matches && query) {
            topic.classList.add('expanded');
        }
    });
}

function openFeedbackModal() {
    const modal = new bootstrap.Modal(document.getElementById('feedbackModal'));
    modal.show();
}

function initRatingStars() {
    const stars = document.querySelectorAll('.rating-star');
    const ratingInput = document.querySelector('input[name="rating"]');
    
    stars.forEach((star, index) => {
        star.addEventListener('click', () => {
            const rating = index + 1;
            ratingInput.value = rating;
            
            stars.forEach((s, i) => {
                s.classList.toggle('active', i < rating);
                s.className = i < rating ? 'bi bi-star-fill rating-star active' : 'bi bi-star rating-star';
            });
        });
        
        star.addEventListener('mouseenter', () => {
            stars.forEach((s, i) => {
                s.className = i <= index ? 'bi bi-star-fill rating-star' : 'bi bi-star rating-star';
            });
        });
    });
    
    document.querySelector('.rating-stars').addEventListener('mouseleave', () => {
        const currentRating = parseInt(ratingInput.value);
        stars.forEach((s, i) => {
            const isActive = i < currentRating;
            s.className = isActive ? 'bi bi-star-fill rating-star active' : 'bi bi-star rating-star';
        });
    });
}

async function submitFeedback() {
    const form = document.getElementById('feedbackForm');
    const formData = new FormData(form);
    
    const feedback = {
        name: formData.get('name'),
        email: formData.get('email'),
        type: formData.get('type'),
        subject: formData.get('subject'),
        message: formData.get('message'),
        rating: parseInt(formData.get('rating'))
    };
    
    try {
        const response = await fetch('/Help/SendFeedback', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(feedback)
        });
        
        const result = await response.json();
        
        if (result.success) {
            showNotification('Feedback enviado com sucesso!', 'success');
            bootstrap.Modal.getInstance(document.getElementById('feedbackModal')).hide();
            form.reset();
            
            // Reset stars
            document.querySelectorAll('.rating-star').forEach((star, i) => {
                star.className = i < 5 ? 'bi bi-star-fill rating-star active' : 'bi bi-star rating-star';
            });
        } else {
            showNotification('Erro ao enviar feedback: ' + result.message, 'error');
        }
    } catch (error) {
        showNotification('Erro ao enviar feedback', 'error');
        console.error('Feedback error:', error);
    }
}

async function loadHelpStats() {
    try {
        const response = await fetch('/api/dashboard/stats');
        const result = await response.json();
        
        if (result.success) {
            const totalDocs = result.data.totalDocuments || 0;
            document.getElementById('totalDocs').textContent = totalDocs.toLocaleString();
        }
    } catch (error) {
        console.error('Error loading help stats:', error);
        document.getElementById('totalDocs').textContent = '0';
    }
}

// Atalhos de teclado
document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + K para focar na busca
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        document.getElementById('helpSearch').focus();
    }
    
    // ESC para fechar tópicos expandidos
    if (e.key === 'Escape') {
        document.querySelectorAll('.topic-item.expanded').forEach(item => {
            item.classList.remove('expanded');
        });
        
        // Limpar busca
        const searchInput = document.getElementById('helpSearch');
        if (searchInput.value) {
            searchInput.value = '';
            searchHelp('');
        }
    }
});

// Auto-expand baseado na URL hash
if (window.location.hash) {
    const hash = window.location.hash.substring(1);
    const targetTopic = document.querySelector(`[data-topic="${hash}"]`);
    if (targetTopic) {
        targetTopic.classList.add('expanded');
        targetTopic.scrollIntoView({ behavior: 'smooth' });
    }
}
</script>